export const arraySeperator="|",blockSeperator="/",wildcard="*",varPrefix="@";export function isAllowed(r,e,n){if(e.length===0)return!1;if(r.length===0)throw new Error("scopie-106: action scopes was empty");let t;n&&(t=new Map(Object.entries(n)));let o=!1;for(let s=0;s<e.length;s+=1){const f=e[s];if(f.length===0)throw new Error("scopie-106: actor rule was empty");const i=f[0]==="a";if(!(i&&o))for(let l=0;l<r.length;l+=1){const c=r[l];if(c.length===0)throw new Error("scopie-106: action scope was empty");const w=h(f,c,t);if(w&&i)o=!0;else if(w&&!i)return!1}}return o}export function validateScope(r){if(r==="")return new Error("scopie-106: scope was empty");let e=!1;for(let n=0;n<r.length;n+=1){if(r[n]===blockSeperator){e=!1;continue}if(r[n]===arraySeperator){e=!0;continue}if(e){if(r[n]===wildcard&&n<r.length-1&&r[n+1]===wildcard)return new Error("scopie-103: super wildcard found in array block");if(r[n]===wildcard)return new Error("scopie-102: wildcard found in array block");if(r[n]===varPrefix){const t=d(r,n);return new Error(`scopie-101: variable '${r.substring(n+1,t)}' found in array block`)}}if(!a(r[n]))return new Error(`scopie-100: invalid character '${r[n]}'`);if(r[n]===wildcard&&n<r.length-1&&r[n+1]===wildcard&&n<r.length-2)return new Error("scopie-105: super wildcard not in the last block")}}function a(r){return r>="a"&&r<="z"||r>="A"&&r<="Z"||r>="0"&&r<="9"?!0:r==="_"||r==="-"||r===varPrefix||r===wildcard}function d(r,e){for(let n=e+1;n<r.length;n+=1)if(r[n]===blockSeperator||r[n]===arraySeperator)return n;return r.length}function u(r,e,n){for(let t=n;t<e.length;t+=1){if(e[t]===blockSeperator)return t;if(e[t]!==arraySeperator&&!a(e[t]))throw new Error(`scopie-100 in ${r}: invalid character '${e[t]}'`)}return e.length}function g(r,e,n,t,o,s,f){let i=e;if(r[i]===varPrefix){const l=r.substring(i+1,n);if(!f.has(l))throw new Error(`scopie-104 in actor: variable '${l}' not found`);return f.get(l)===t.substring(o,s)}if(n-i===1&&r[i]===wildcard)return!0;if(r.substring(i,n).indexOf(arraySeperator)>=0){for(;i<n;){const l=d(r,i);if(r[i]===varPrefix)throw new Error(`scopie-101 in actor: variable '${r.substring(i+1,l)}' found in array block`);if(r[i]===wildcard)throw l-i>1&&r[i+1]===wildcard?new Error("scopie-103 in actor: super wildcard found in array block"):new Error("scopie-102 in actor: wildcard found in array block");if(r.substring(i,l)===t.substring(o,s))return!0;i=l+1}return!1}return r.substring(e,n)===t.substring(o,s)}function h(r,e,n){let t=u("actor",r,0)+1,o=0,s=0,f=0;for(;t<r.length||o<e.length;){if(t<r.length!=o<e.length)return!1;if(s=u("action",e,o),f=u("actor",r,t),f-t===2&&r[t]===wildcard&&r[t+1]===wildcard){if(r.length>f)throw new Error("scopie-105 in actor: super wildcard not in the last block");return!0}if(!g(r,t,f,e,o,s,n))return!1;o=s+1,t=f+1}return!0}
//# sourceMappingURL=scopie.browser.min.js.map
