export const arraySeparator="|",blockSeparator="/",wildcard="*",varPrefix="@",allowGrant="allow",denyGrant="deny";function w(t){return t>="a"&&t<="z"||t>="A"&&t<="Z"||t>="0"&&t<="9"?!0:t==="_"||t==="-"}function d(t){return w(t)||t==="@"||t==="*"}function h(t,r){for(let n=r+1;n<t.length;n+=1)if(t[n]==="/"||t[n]==="|")return n;return t.length}function g(t){if(t.startsWith(denyGrant))return 5;if(t.startsWith(allowGrant))return 6;throw new Error("scopie-107: permission does not start with a grant")}function s(t,r,n){for(let e=n;e<r.length;e+=1){if(r[e]==="/")return e;if(r[e]!=="|"&&!d(r[e]))throw new Error(`scopie-100 in ${t}: invalid character '${r[e]}'`)}return r.length}function p(t,r,n,e,o,a,l){if(t[r]==="@"){const i=t.substring(r+1,n);if(!l.has(i))throw new Error(`scopie-104: variable '${i}' not found`);return l.get(i)===e.substring(o,a)}if(n-r===1&&t[r]==="*")return!0;if(t.substring(r,n).indexOf("|")>=0){for(;r<n;){const i=h(t,r);if(t[r]==="@")throw new Error(`scopie-101: variable '${t.substring(r+1,i)}' found in array block`);if(t[r]==="*")throw i-r>1&&t[r+1]==="*"?new Error("scopie-103: super wildcard found in array block"):new Error("scopie-102: wildcard found in array block");if(t.substring(r,i)===e.substring(o,a))return!0;r=i+1}return!1}return t.substring(r,n)===e.substring(o,a)}function y(t,r,n){let e=g(r),o=0,a=0,l=0;for(;e<r.length||o<t.length;){if(e<r.length!=o<t.length)return!1;if(l=s("action",t,o),a=s("permission",r,e),a-e===2&&r[e]==="*"&&r[e+1]==="*"){if(r.length>a)throw new Error("scopie-105: super wildcard not in the last block");return!0}if(!p(r,e,a,t,o,l,n))return!1;o=l+1,e=a+1}return!0}export function isAllowed(t,r,n){if(r.length===0)return!1;if(t.length===0)throw new Error("scopie-106 in action: actions was empty");let e;n&&(e=new Map(Object.entries(n)));let o=!1;for(let a=0;a<r.length;a+=1){const l=r[a];if(l.length===0)throw new Error("scopie-106 in permission: permission was empty");const i=l[0]==="a";if(!(i&&o))for(let c=0;c<t.length;c+=1){const f=t[c];if(f.length===0)throw new Error("scopie-106 in action: action was empty");const u=y(f,l,e);if(u&&i)o=!0;else if(u&&!i)return!1}}return o}export function validateActions(t){if(t.length===0)return new Error("scopie-106: action array was empty");for(let r of t){if(r.length===0)return new Error("scopie-106: action was empty");for(let n=0;n<r.length;n+=1)if(!w(r[n])&&r[n]!=="/")return new Error(`scopie-100: invalid character '${r[n]}'`)}}export function validatePermissions(t){if(t.length===0)return new Error("scopie-106: permission array was empty");for(let r of t){if(r.length===0)return new Error("scopie-106: permission was empty");let n=!1,e=0;try{e=g(r)}catch(o){return o}for(;e<r.length;e+=1){if(r[e]==="/"){n=!1;continue}if(r[e]==="|"){n=!0;continue}if(n){if(r[e]==="*"&&e<r.length-1&&r[e+1]==="*")return new Error("scopie-103: super wildcard found in array block");if(r[e]==="*")return new Error("scopie-102: wildcard found in array block");if(r[e]==="@"){const o=h(r,e);return new Error(`scopie-101: variable '${r.substring(e+1,o)}' found in array block`)}}if(!d(r[e]))return new Error(`scopie-100: invalid character '${r[e]}'`);if(r[e]==="*"&&e<r.length-1&&r[e+1]==="*"&&e<r.length-2)return new Error("scopie-105: super wildcard not in the last block")}}}
//# sourceMappingURL=scopie.browser.min.js.map
